<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />
  <title>Reset Password - Verify OTP</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
        --primary-color: #FFC451;
        --primary-dark: #e0a93d;
        --primary-light: #ffdc82;
        --accent-color: #ffae00;
        --success-color: #10b981;
        --danger-color: #ef4444;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: #ffffff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        padding: 1rem;
        position: relative;
        overflow-x: hidden;
    }

    body::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 300px;
        background: linear-gradient(135deg, #FFC451 0%, #ffae00 50%, #ffe58a 100%);
        opacity: 0.05;
        z-index: 0;
    }

    .container {
        max-width: 550px;
    }

    .card {
        border-radius: 20px;
        background: #ffffff;
        border: 1px solid rgba(255, 196, 81, 0.2);
        box-shadow: 0 0 25px rgba(255, 196, 81, 0.15);
        overflow: hidden;
        position: relative;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #FFC451 0%, #ffdd83 100%);
    }

    .card-header-custom {
        background: linear-gradient(135deg, #FFC451 0%, #e6b63f 100%);
        padding: 25px;
        text-align: center;
    }

    .card-header-custom h3 {
        color: #000;
        font-weight: 700;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .card-header-custom .icon {
        font-size: 30px;
        color: #000;
    }

    .card-body-custom {
        padding: 35px;
    }

    .form-label {
        font-weight: 500;
        color: #6b7280;
        font-size: 14px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-label i {
        color: #FFC451;
        font-size: 16px;
    }

    .form-control {
        width: 100%;
        padding: 0.875rem 1rem 0.875rem 1rem;
        border-radius: 12px;
        border: 2px solid var(--border-color);
        font-size: 0.9375rem;
        background: #fafafa;
        color: var(--text-primary);
        transition: all 0.3s ease;
    }

    .form-control:hover {
        border-color: var(--primary-light);
        background: #ffffff;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(255, 196, 81, 0.2);
    }



    .form-control::placeholder {
        color: #aaa;
    }

      .form-control:disabled {
        background-color: #fff;
        cursor: not-allowed;
        color: #000;
    }

    .input-group .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .btn-primary {
        background: linear-gradient(135deg, #FFC451 0%, #e6b63f 100%);
        border: none;
        border-radius: 10px;
        padding: 12px 24px;
        font-weight: 600;
        font-size: 15px;
        color: #000;
        transition: 0.3s;
        box-shadow: 0 4px 12px rgba(255, 196, 81, 0.4);
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(255, 196, 81, 0.5);
    }

    .btn-primary:disabled {
        background: #777;
        color: #000;
        cursor: not-allowed;
    }

    .btn-success {
        background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
        border: none;
        border-radius: 10px;
        padding: 12px 24px;
        font-weight: 600;
        font-size: 15px;
        box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4);
        color: #fff;
    }

    .input-group .btn-primary,
    .input-group .btn-success {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    #otpResponseMessage {
        font-size: 13px;
        margin-top: 8px;
        font-weight: 500;
    }

    #otpResponseMessage[style*="green"] {
        color: #16a34a;
    }

    #otpResponseMessage[style*="red"] {
        color: #f87171;
    }

    .section-divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 30px 0;
        color: #aaa;
        font-size: 13px;
        font-weight: 500;
    }

    .section-divider::before,
    .section-divider::after {
        content: '';
        flex: 1;
        border-bottom: 1px solid #333;
    }

    .section-divider span {
        padding: 0 15px;
        color: #FFC451;
    }

    .form-section {
        background-color: #fff;
        border-radius: 12px;
        padding: 25px;
        margin-top: 20px;
        border: 1px solid rgba(0, 0, 0, 0.2);
    }

    .btn-primary.w-50 {
        width: 100% !important;
        padding: 14px;
        font-size: 16px;
        letter-spacing: 0.5px;
    }

    .back-to-login {
        text-align: center;
        margin-top: 25px;
    }

    .back-to-login a {
        color: #FFC451;
        font-weight: 600;
        text-decoration: none;
        transition: color 0.3s;
    }

    .back-to-login a:hover {
        color: #ffdd83;
        text-decoration: underline;
    }

    @media (max-width: 576px) {
        .card-body-custom {
            padding: 25px 20px;
        }

        .card-header-custom h3 {
            font-size: 22px;
        }
    }
  </style>
</head>

<body>
<div class="container">
  <div class="col-md-12 mx-auto">
    <div class="card">
      <div class="card-header-custom">
        <h3><i class="fas fa-key icon"></i> Reset Your Password</h3>
      </div>

      <div class="card-body-custom">
        <!-- Email Input -->
        <div class="mb-3">
          <form id="sendOtpForm">
            <label for="forUsername" class="form-label">
              <i class="fas fa-user"></i>
              Enter your username
            </label>
            <div class="input-group">
              <input type="text" class="form-control" id="forUsername" name="username"
                     placeholder="Enter your username" required>
              <button type="submit" class="btn btn-primary" id="sendOtpBtn">
                <i class="fas fa-paper-plane"></i> Send OTP
              </button>
            </div>
            <p id="otpResponseMessage"></p>
          </form>
        </div>

        <div class="section-divider">
          <span>VERIFICATION STEP</span>
        </div>

        <!-- OTP, New Password, Confirm Password -->
        <form id="submitOtpForm">
          <input type="hidden" id="setUsername" name="username">

          <div class="form-section">
            <div class="mb-3">
              <label for="otp" class="form-label">
                <i class="fas fa-shield-alt"></i>
                Enter OTP
              </label>
              <input type="text" class="form-control" id="otp" name="otp" placeholder="6-digit OTP"
                     onkeyup="document.getElementById('setUsername').value = document.getElementById('forUsername').value;"
                     required>
            </div>

            <div class="mb-3">
              <label for="newPassword" class="form-label">
                <i class="fas fa-lock"></i>
                New Password
              </label>
              <input type="password" class="form-control" id="newPassword" name="newPassword"
                     placeholder="New password" required>
            </div>

            <div class="mb-3">
              <label for="confirmPassword" class="form-label">
                <i class="fas fa-lock-open"></i>
                Confirm Password
              </label>
              <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                     placeholder="Confirm password" required>
            </div>
          </div>

          <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary w-50">
              <i class="fas fa-check-circle"></i> Update Password
            </button>
          </div>
        </form>

        <!-- Back to Login -->
        <div class="back-to-login">
          <a href="/login"><i class="fas fa-arrow-left me-1"></i> Back to Login</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let otpSentSuccessfully = false;

  document.getElementById("sendOtpForm").addEventListener("submit", function (e) {
      e.preventDefault();
      if (otpSentSuccessfully) return;

      const sendOtpBtn = document.getElementById('sendOtpBtn');
      const usernameInput = document.getElementById('forUsername');
      const otpResponseMessage = document.getElementById('otpResponseMessage');

      sendOtpBtn.disabled = true;
      sendOtpBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Sending...';

      let formData = new FormData(this);
      const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute("content");
      const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");

      fetch("/request-password-update", {
          method: "POST",
          headers: {
              [csrfHeader]: csrfToken
          },
          body: formData
      })
          .then(res => res.json())
          .then(data => {
              if (data.usernameNotFound) {
                  otpResponseMessage.innerHTML = "Username isn't registered!";
                  otpResponseMessage.style.color = "red";
                  sendOtpBtn.disabled = false;
                  sendOtpBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send OTP';
                  otpSentSuccessfully = false;
              }
              else {
                  otpResponseMessage.innerHTML = "OTP sent successfully to your email!";
                  otpResponseMessage.style.color = "green";
                  sendOtpBtn.disabled = true;
                  sendOtpBtn.className = 'btn btn-success';
                  sendOtpBtn.innerHTML = '<i class="fas fa-check-circle"></i> OTP Sent';
                  usernameInput.disabled = true;
                  otpSentSuccessfully = true;
              }
          })
          .catch(error => {
              console.error('Error:', error);
              otpResponseMessage.innerHTML = "An error occurred. Please try again.";
              otpResponseMessage.style.color = "red";
              sendOtpBtn.disabled = false;
              sendOtpBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send OTP';
          });
  });

  document.getElementById('submitOtpForm').addEventListener("submit", function (event) {
      event.preventDefault();

      const username = document.getElementById('forUsername').value.trim();
      if (!username) {
          alert("Please enter your username!");
          return;
      }

      const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute("content");
      const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");

      let formData = new FormData(this);

      fetch("/verify-otp-and-update-password", {
          method: "POST",
          headers: {
              [csrfHeader]: csrfToken
          },
          body: formData
      })
          .then(res => res.json())
          .then(data => {
              if (data.invalidOrExpired) {
                  alert("❌ Invalid or expired OTP!");
              } else if (data.userNotFound) {
                  alert("⚠️ User not found!");
              } else if (data.passwordUpdated) {
                  alert("✅ Password updated successfully!");
                  window.location.href = "/login";
              } else {
                  alert("Something went wrong!");
              }
          })
          .catch(error => console.error("Error:", error));
  });
</script>
</body>

</html>

<!--<!DOCTYPE html>-->
<!--<html lang="en" xmlns:th="http://www.thymeleaf.org">-->

<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <meta name="_csrf" th:content="${_csrf.token}" />-->
<!--  <meta name="_csrf_header" th:content="${_csrf.headerName}" />-->
<!--  <title>Reset Password - Verify OTP</title>-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">-->

<!--  <style>-->
<!--    * {-->
<!--      margin: 0;-->
<!--      padding: 0;-->
<!--      box-sizing: border-box;-->
<!--    }-->

<!--    body {-->
<!--      background-color: #ffffff;-->
<!--      min-height: 100vh;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      justify-content: center;-->
<!--      font-family: 'Poppins', sans-serif;-->
<!--      padding: 20px;-->
<!--      background-image:-->
<!--        radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.03) 0%, transparent 50%),-->
<!--        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.03) 0%, transparent 50%);-->
<!--    }-->

<!--    .container {-->
<!--      max-width: 550px;-->
<!--    }-->

<!--    .card {-->
<!--      border-radius: 20px;-->
<!--      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);-->
<!--      border: 1px solid rgba(99, 102, 241, 0.1);-->
<!--      background: #ffffff;-->
<!--      overflow: hidden;-->
<!--      position: relative;-->
<!--    }-->

<!--    .card::before {-->
<!--      content: '';-->
<!--      position: absolute;-->
<!--      top: 0;-->
<!--      left: 0;-->
<!--      right: 0;-->
<!--      height: 5px;-->
<!--      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);-->
<!--    }-->

<!--    .card-header-custom {-->
<!--      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--      padding: 30px;-->
<!--      text-align: center;-->
<!--      margin: -1px -1px 0 -1px;-->
<!--    }-->

<!--    .card-header-custom h3 {-->
<!--      color: #ffffff;-->
<!--      font-weight: 600;-->
<!--      font-size: 26px;-->
<!--      margin: 0;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      justify-content: center;-->
<!--      gap: 12px;-->
<!--    }-->

<!--    .card-header-custom .icon {-->
<!--      font-size: 32px;-->
<!--    }-->

<!--    .card-body-custom {-->
<!--      padding: 35px;-->
<!--    }-->

<!--    .form-label {-->
<!--      font-weight: 500;-->
<!--      color: #374151;-->
<!--      font-size: 14px;-->
<!--      margin-bottom: 8px;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      gap: 8px;-->
<!--    }-->

<!--    .form-label i {-->
<!--      color: #667eea;-->
<!--      font-size: 16px;-->
<!--    }-->

<!--    .form-control {-->
<!--      border: 2px solid #e5e7eb;-->
<!--      border-radius: 10px;-->
<!--      padding: 12px 16px;-->
<!--      font-size: 15px;-->
<!--      transition: all 0.3s ease;-->
<!--      background-color: #f9fafb;-->
<!--    }-->

<!--    .form-control:focus {-->
<!--      border-color: #667eea;-->
<!--      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);-->
<!--      background-color: #ffffff;-->
<!--    }-->

<!--    .form-control::placeholder {-->
<!--      color: #9ca3af;-->
<!--    }-->

<!--    .form-control:disabled {-->
<!--      background-color: #e5e7eb;-->
<!--      cursor: not-allowed;-->
<!--    }-->

<!--    .input-group {-->
<!--      position: relative;-->
<!--    }-->

<!--    .input-group .form-control {-->
<!--      border-top-right-radius: 0;-->
<!--      border-bottom-right-radius: 0;-->
<!--    }-->

<!--    .btn-primary {-->
<!--      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--      border: none;-->
<!--      border-radius: 10px;-->
<!--      padding: 12px 24px;-->
<!--      font-weight: 600;-->
<!--      font-size: 15px;-->
<!--      transition: all 0.3s ease;-->
<!--      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);-->
<!--    }-->

<!--    .btn-primary:hover:not(:disabled) {-->
<!--      transform: translateY(-2px);-->
<!--      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);-->
<!--      background: linear-gradient(135deg, #5568d3 0%, #6a3e8f 100%);-->
<!--    }-->

<!--    .btn-primary:active {-->
<!--      transform: translateY(0);-->
<!--    }-->

<!--    .btn-primary:disabled {-->
<!--      background: #9ca3af;-->
<!--      cursor: not-allowed;-->
<!--      box-shadow: none;-->
<!--      opacity: 0.6;-->
<!--    }-->

<!--    .btn-success {-->
<!--      background: linear-gradient(135deg, #10b981 0%, #059669 100%);-->
<!--      border: none;-->
<!--      border-radius: 10px;-->
<!--      padding: 12px 24px;-->
<!--      font-weight: 600;-->
<!--      font-size: 15px;-->
<!--      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);-->
<!--      cursor: default;-->
<!--    }-->

<!--    .input-group .btn-primary,-->
<!--    .input-group .btn-success {-->
<!--      border-top-left-radius: 0;-->
<!--      border-bottom-left-radius: 0;-->
<!--      border-top-right-radius: 10px;-->
<!--      border-bottom-right-radius: 10px;-->
<!--    }-->

<!--    #otpResponseMessage {-->
<!--      font-size: 13px;-->
<!--      margin-top: 8px;-->
<!--      margin-left: 4px;-->
<!--      font-weight: 500;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      gap: 6px;-->
<!--    }-->

<!--    #otpResponseMessage::before {-->
<!--      font-family: 'Font Awesome 6 Free';-->
<!--      font-weight: 900;-->
<!--    }-->

<!--    #otpResponseMessage[style*="green"]::before {-->
<!--      content: '\f058';-->
<!--    }-->

<!--    #otpResponseMessage[style*="red"]::before {-->
<!--      content: '\f06a';-->
<!--    }-->

<!--    .divider-custom {-->
<!--      margin: 30px 0;-->
<!--      height: 2px;-->
<!--      background: linear-gradient(90deg, transparent, #e5e7eb, transparent);-->
<!--      border: none;-->
<!--    }-->

<!--    .section-divider {-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      text-align: center;-->
<!--      margin: 30px 0;-->
<!--      color: #6b7280;-->
<!--      font-size: 13px;-->
<!--      font-weight: 500;-->
<!--    }-->

<!--    .section-divider::before,-->
<!--    .section-divider::after {-->
<!--      content: '';-->
<!--      flex: 1;-->
<!--      border-bottom: 2px solid #e5e7eb;-->
<!--    }-->

<!--    .section-divider span {-->
<!--      padding: 0 15px;-->
<!--    }-->

<!--    .mb-3 {-->
<!--      margin-bottom: 20px;-->
<!--    }-->

<!--    .password-strength-indicator {-->
<!--      height: 4px;-->
<!--      border-radius: 2px;-->
<!--      background-color: #e5e7eb;-->
<!--      margin-top: 8px;-->
<!--      overflow: hidden;-->
<!--    }-->

<!--    .btn-primary.w-50 {-->
<!--      width: 100% !important;-->
<!--      padding: 14px;-->
<!--      font-size: 16px;-->
<!--      letter-spacing: 0.5px;-->
<!--    }-->

<!--    .form-section {-->
<!--      background-color: #f9fafb;-->
<!--      border-radius: 12px;-->
<!--      padding: 25px;-->
<!--      margin-top: 20px;-->
<!--      border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .spinner-border-sm {-->
<!--      width: 1rem;-->
<!--      height: 1rem;-->
<!--      border-width: 2px;-->
<!--    }-->

<!--    @media (max-width: 576px) {-->
<!--      .card-body-custom {-->
<!--        padding: 25px 20px;-->
<!--      }-->

<!--      .card-header-custom h3 {-->
<!--        font-size: 22px;-->
<!--      }-->
<!--    }-->
<!--       .back-to-login {-->
<!--      text-align: center;-->
<!--      margin-top: 25px;-->
<!--    }-->

<!--    .back-to-login a {-->
<!--      color: #FFC451;-->
<!--      font-weight: 600;-->
<!--      text-decoration: none;-->
<!--      transition: color 0.3s ease;-->
<!--    }-->

<!--    .back-to-login a:hover {-->
<!--      color: #e0a93d;-->
<!--      text-decoration: underline;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->

<!--<body>-->
<!--<div class="container">-->
<!--  <div class="col-md-12 mx-auto">-->
<!--    <div class="card">-->
<!--      <div class="card-header-custom">-->
<!--        <h3><i class="fas fa-key icon"></i> Reset Your Password</h3>-->
<!--      </div>-->

<!--      <div class="card-body-custom">-->
<!--        &lt;!&ndash; Email Input &ndash;&gt;-->
<!--        <div class="mb-3">-->
<!--          <form id="sendOtpForm">-->
<!--            <label for="forUsername" class="form-label">-->
<!--              <i class="fas fa-user"></i>-->
<!--              Enter your username-->
<!--            </label>-->
<!--            <div class="input-group">-->
<!--              <input type="text" class="form-control" id="forUsername" name="username" placeholder="Enter your username"   required>-->
<!--              <button type="submit" class="btn btn-primary" id="sendOtpBtn">-->
<!--                <i class="fas fa-paper-plane"></i> Send OTP-->
<!--              </button>-->
<!--            </div>-->
<!--            <p id="otpResponseMessage"></p>-->
<!--          </form>-->
<!--        </div>-->

<!--        <div class="section-divider">-->
<!--          <span>VERIFICATION STEP</span>-->
<!--        </div>-->

<!--        &lt;!&ndash; OTP, New Password, Confirm Password &ndash;&gt;-->
<!--        <form id="submitOtpForm" >-->
<!--&lt;!&ndash;          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />&ndash;&gt;-->
<!--&lt;!&ndash;          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />&ndash;&gt;-->
<!--          <input type="hidden" id="setUsername" name="username" >-->

<!--          <div class="form-section">-->
<!--            <div class="mb-3">-->
<!--              <label for="otp" class="form-label">-->
<!--                <i class="fas fa-shield-alt"></i>-->
<!--                Enter OTP-->
<!--              </label>-->
<!--              <input type="text" class="form-control" id="otp" name="otp" placeholder="6-digit OTP" onkeyup="document.getElementById('setUsername').value = document.getElementById('forUsername').value;" required>-->
<!--            </div>-->

<!--            <div class="mb-3">-->
<!--              <label for="newPassword" class="form-label">-->
<!--                <i class="fas fa-lock"></i>-->
<!--                New Password-->
<!--              </label>-->
<!--              <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="New password" required>-->
<!--            </div>-->

<!--            <div class="mb-3">-->
<!--              <label for="confirmPassword" class="form-label">-->
<!--                <i class="fas fa-lock-open"></i>-->
<!--                Confirm Password-->
<!--              </label>-->
<!--              <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="text-center mt-4">-->
<!--            <button type="submit" class="btn btn-primary w-50">-->
<!--              <i class="fas fa-check-circle"></i> Update Password-->
<!--            </button>-->
<!--          </div>-->
<!--        </form>-->

<!--          &lt;!&ndash; Back to Login &ndash;&gt;-->
<!--          <div class="back-to-login">-->
<!--              <a href="/login"><i class="fas fa-arrow-left me-1"></i> Back to Login</a>-->
<!--          </div>-->

<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->
<!--</body>-->

<!--&lt;!&ndash;Send Otp Form Submit&ndash;&gt;-->
<!--<script>-->
<!--  let otpSentSuccessfully = false;-->

<!--  document.getElementById("sendOtpForm").addEventListener("submit", function(e) {-->
<!--    console.log("OKKKKKKKKKK");-->
<!--    e.preventDefault();-->

<!--    // Prevent submission if OTP already sent successfully-->
<!--    if (otpSentSuccessfully) {-->
<!--      return;-->
<!--    }-->

<!--    const sendOtpBtn = document.getElementById('sendOtpBtn');-->
<!--    const usernameInput = document.getElementById('forUsername');-->
<!--    const otpResponseMessage = document.getElementById('otpResponseMessage');-->

<!--    // Disable button and show loading state-->
<!--    sendOtpBtn.disabled = true;-->
<!--    sendOtpBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Sending...';-->

<!--    let formData = new FormData(this);-->

<!--    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute("content");-->
<!--    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");-->

<!--    fetch("/request-password-update", {-->
<!--        method: "POST",-->
<!--        headers: {-->
<!--            [csrfHeader]: csrfToken-->
<!--        },-->
<!--        body: formData-->
<!--    })-->
<!--    .then(res => res.json())-->
<!--    .then(data => {-->
<!--        if(data.usernameNotFound){-->
<!--            // Username not found - allow retry-->
<!--            otpResponseMessage.innerHTML = "Username isn't registered!";-->
<!--            otpResponseMessage.style.color = "red";-->

<!--            // Re-enable button for retry-->
<!--            sendOtpBtn.disabled = false;-->
<!--            sendOtpBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send OTP';-->
<!--            otpSentSuccessfully = false;-->
<!--        }-->
<!--        else {-->
<!--            // OTP sent successfully-->
<!--            otpResponseMessage.innerHTML = "OTP sent successfully to your email!";-->
<!--            otpResponseMessage.style.color = "green";-->

<!--            // Change button to success state and keep it disabled-->
<!--            sendOtpBtn.disabled = true;-->
<!--            sendOtpBtn.className = 'btn btn-success';-->
<!--            sendOtpBtn.innerHTML = '<i class="fas fa-check-circle"></i> OTP Sent';-->

<!--            // Disable username input to prevent changes-->
<!--            usernameInput.disabled = true;-->

<!--            // Set flag to prevent further submissions-->
<!--            otpSentSuccessfully = true;-->
<!--        }-->
<!--    })-->
<!--    .catch(error => {-->
<!--        console.error('Error:', error);-->
<!--        otpResponseMessage.innerHTML = "An error occurred. Please try again.";-->
<!--        otpResponseMessage.style.color = "red";-->

<!--        // Re-enable button on error-->
<!--        sendOtpBtn.disabled = false;-->
<!--        sendOtpBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send OTP';-->
<!--    });-->
<!--  });-->

<!-- document.getElementById('submitOtpForm').addEventListener("submit", function(event) {-->

<!-- console.log("OK OTPPPP");-->
<!--  event.preventDefault();-->

<!--     const username = document.getElementById('forUsername').value.trim();-->
<!--        if (!username) {-->
<!--          alert("Please enter your username!");-->
<!--          return;-->
<!--        }-->

<!--     const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute("content");-->
<!--    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute("content");-->

<!--  let formData = new FormData(this);-->

<!--  fetch("/verify-otp-and-update-password", {-->
<!--    method: "POST",-->
<!--        headers: {-->
<!--            [csrfHeader]: csrfToken-->
<!--        },-->
<!--    body: formData-->
<!--  })-->
<!--  .then(res => res.json())-->
<!--  .then(data => {-->
<!--    if (data.invalidOrExpired) {-->
<!--      alert("❌ Invalid or expired OTP!");-->
<!--    } else if (data.userNotFound) {-->
<!--      alert("⚠️ User not found!");-->
<!--    } else if (data.passwordUpdated) {-->
<!--      alert("✅ Password updated successfully!");-->
<!--       window.location.href = "/login";-->
<!--    } else {-->
<!--      alert("Something went wrong!");-->
<!--    }-->
<!--  })-->
<!--  .catch(error => console.error("Error:", error));-->
<!--});-->


<!--</script>-->

<!--</html>-->
